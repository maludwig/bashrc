#!/bin/bash

set -e

SCRIPTDIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
echo "bashrc repo found at $SCRIPTDIR"

echo "Uninstall the software, if it is already installed..."
"$SCRIPTDIR/uninstall"
echo "Successful, continuing with install..."

rsync -av "$SCRIPTDIR/" "$HOME/bashrc.extensions/"

if [[ -f "$HOME/.bashrc" ]]; then
  echo -e "\nsource $HOME/bashrc.extensions/main\n" >> "$HOME/.bashrc"
elif [[ -f "$HOME/.bash_profile" ]]; then
  echo -e "\nsource $HOME/bashrc.extensions/main\n" >> "$HOME/.bash_profile"
fi
if ! [[ -d "$HOME/profile.d" ]]; then
  rsync -av "$SCRIPTDIR/profile.d/" "$HOME/profile.d/"
fi

cd "$HOME/bashrc.extensions"
git pull
git submodule update --init --recursive

echo '
The maludwig/bashrc extensions were installed to: $HOME/bashrc.extensions
  You can delete this directory now, if you like.
  If you want to extend the current set with your own user-specific extensions
   you can add them to your local ~/profile.d with a .sh extension
  Check out ~/profile.d/sample.sh for an example.
  On most platforms /etc/profile.d/*.sh scripts are run for all users.

Restart bash to experience the new world

You may also want to install these for the root user, like so:
  sudo su -c "$SCRIPTDIR/install"
'

